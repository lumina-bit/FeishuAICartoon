# 飞书AI动态漫生成系统

基于飞书多维表格的AI动态漫生成系统，支持从剧本到分镜、图片、视频的全流程自动化生成。

## 功能特性

### 1. 剧本管理
- 从飞书多维表格获取剧本列表
- 支持剧本状态跟踪

### 2. 分镜生成
- **动态创建分镜表格**：点击"拆分剧本"按钮自动创建分镜表格
- **AI智能分镜**：基于剧本内容自动生成详细的分镜
- 分镜状态管理

### 3. 图片生成
- 基于分镜描述生成图片
- 支持单个分镜图片生成
- 支持批量图片生成

### 4. 语音生成
- **智能配音**：根据分镜描述、旁白和角色特征，自动选择合适的音色和情感
- 支持单个分镜语音生成
- 支持批量语音生成
- 支持情感分析和智能情感匹配

### 5. 视频生成
- 基于生成的图片生成视频
- 支持全部分镜视频生成

## 快速开始（使用exe文件）

### 1. 运行应用程序

1. 双击运行提供的 `feishu-ai-cartoon.exe` 文件
2. 等待控制台窗口出现，显示服务启动信息
3. 服务将自动在 `http://localhost:3002` 启动

### 2. 配置系统

1. 在浏览器中访问配置页面：`http://localhost:3002/config.html`
2. 配置以下必要信息：
   
   **飞书应用配置**
   - `FEISHU_APP_ID`：您的飞书应用ID
   - `FEISHU_APP_SECRET`：您的飞书应用密钥
   - `FEISHU_APP_TOKEN`：您的飞书应用令牌
   - `FEISHU_TABLE_ID_SCRIPT`：您的剧本表格ID
   
   **AI服务配置**
   - `AI_API_KEY`：AI服务API密钥
   - `AI_BASE_URL`：AI服务基础URL
   - `AI_MODEL`：AI模型名称
   
   **TTS服务配置**
   - `INDEX_TTS_BASE_URL`：TTS服务地址
   - `INDEX_TTS_DEFAULT_VOICE`：默认音色文件路径
   - `INDEX_TTS_DEFAULT_EMO_ALPHA`：默认情感强度 (0-1)

3. 点击"保存配置"按钮保存您的配置

### 3. 访问主界面

在浏览器中访问：`http://localhost:3002`

## 使用流程

### 1. 飞书应用准备（首次使用）

1. 登录 [飞书开发者平台](https://open.feishu.cn/app)
2. 创建新应用，选择「企业自建」应用类型
3. 配置应用权限：
   - 多维表格权限：读取、写入、创建表格
   - 云文档权限：读取文件
   - 消息通知权限：发送消息
4. 获取应用凭证（填入配置页面）：
   - `FEISHU_APP_ID`：应用ID
   - `FEISHU_APP_SECRET`：应用密钥
   - `FEISHU_APP_TOKEN`：应用令牌

### 2. 飞书剧本表格准备

1. 在飞书多维表格中创建新表格，命名为「剧本表」
2. 添加以下字段：
   - **剧本名称**：单行文本类型
   - **剧本内容**：多行文本类型
   - **状态**：单选类型，选项包括：「待处理」、「分镜中」、「分镜完成」、「图片生成中」、「图片完成」、「语音生成中」、「语音完成」、「视频生成中」、「视频完成」
   - **分镜表格**：单行文本类型（用于存储动态创建的分镜表格ID）
   - **角色表格**：单行文本类型（用于存储动态创建的角色表格ID）
   - **角色列表**：单行文本类型（用于存储提取的角色名称）
3. 从表格URL中提取表格ID（格式：`tblxxxxxxxxxxxxxx`）
4. 将表格ID填入配置页面的`FEISHU_TABLE_ID_SCRIPT`字段

### 3. 生成流程

1. **访问应用**：在浏览器中访问 `http://localhost:3002`
2. **登录验证**：输入授权码进行登录
3. **选择剧本**：在剧本列表中选择要处理的剧本
4. **拆分剧本**：点击「拆分剧本」按钮，系统自动创建分镜表格
5. **生成分镜**：点击「AI生成分镜和角色」按钮，系统自动生成详细分镜
6. **生成内容**：根据需要生成图片、语音和视频

### 4. 功能使用详解

#### 4.1 剧本管理
- **查看剧本**：在剧本列表中查看所有剧本
- **选择剧本**：点击剧本名称选择要处理的剧本
- **剧本状态**：系统自动更新剧本状态

#### 4.2 分镜生成
- **动态表格创建**：点击「拆分剧本」自动创建分镜表格
- **AI分镜**：系统基于剧本内容智能生成分镜
- **分镜字段**：分镜表格包含分镜名称、角色、场景、描述、旁白、台词等字段

#### 4.3 图片生成
- **单个生成**：点击分镜列表中的「生成图片」按钮
- **批量生成**：点击「批量生成图片」按钮
- **风格控制**：在风格输入框中指定图片风格

#### 4.4 语音生成
- **智能配音**：系统根据角色特征和情感自动匹配音色
- **单个生成**：点击分镜列表中的「生成语音」按钮
- **批量生成**：点击「批量生成语音」按钮

#### 4.5 视频生成
- **一键合成**：点击「一键合成视频」按钮
- **片段管理**：系统自动处理所有分镜片段
- **自动打开目录**：视频生成完成后自动打开包含最终视频的文件夹

## 配置说明

### 配置页面访问

应用启动后，在浏览器中访问：`http://localhost:3002/config.html`

### 配置项详解

#### 1. 飞书应用配置

| 配置项 | 说明 | 示例 |
|--------|------|------|
| FEISHU_APP_ID | 飞书应用ID | cli_xxxxxxxxxxxxxx |
| FEISHU_APP_SECRET | 飞书应用密钥 | xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx |
| FEISHU_APP_TOKEN | 飞书应用令牌 | xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx |
| FEISHU_TABLE_ID_SCRIPT | 剧本表格ID | tblxxxxxxxxxxxxxx |

#### 2. AI服务配置

| 配置项 | 说明 | 示例 |
|--------|------|------|
| AI_API_KEY | AI服务API密钥 | sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx |
| AI_BASE_URL | AI服务基础URL | https://api.openai.com/v1 |
| AI_MODEL | AI模型名称 | gpt-3.5-turbo |

#### 3. TTS服务配置

| 配置项 | 说明 | 示例 |
|--------|------|------|
| INDEX_TTS_BASE_URL | TTS服务地址 | http://localhost:7860 |
| INDEX_TTS_DEFAULT_VOICE | 默认音色文件路径 | examples/voice_01.wav |
| INDEX_TTS_DEFAULT_EMO_ALPHA | 默认情感强度 (0-1) | 0.6 |

## 常见问题

### 1. 应用无法启动
- 确保您的系统安装了必要的运行库
- 检查控制台窗口的错误信息
- 确保端口3002未被其他程序占用

### 2. 飞书API调用失败
- 检查飞书应用权限配置是否正确
- 确认配置页面中的飞书凭证信息正确
- 检查网络连接是否正常

### 3. AI生成失败
- 检查AI API密钥和URL配置
- 确认AI服务正常运行
- 检查提示词格式是否正确

### 4. 视频生成失败
- 确保系统已安装FFmpeg（应用会自动检测）
- 检查视频片段格式是否兼容
- 查看控制台窗口的详细错误信息

### 5. 语音生成失败
- 确认TTS服务已启动
- 检查TTS服务URL配置是否正确
- 查看控制台窗口的错误信息

## 许可证

MIT
